<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>דפי עבודה — משוואות ריבועיות</title>
  <link rel="stylesheet" href="./print.css" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#1e3a8a" />
  <link rel="icon" href="./assets/icons/icon-192.png" />
  <link rel="apple-touch-icon" href="./assets/icons/icon-192.png" />
</head>
<body>
  <div class="viewer-top">
    <div class="viewer-title" id="t"></div>
    <div class="viewer-sub" id="st"></div>
    <div class="viewer-actions" id="nav"></div>
  </div>

  <div class="stage">
    <div class="page">
      <iframe id="pv" src="./pages/page-1.html" loading="eager"></iframe>
    </div>
  </div>

<script>
let book=null, idx=1;

function setFrame(n){
  idx=n;
  const frame=document.getElementById("pv");
  frame.src = "./pages/page-" + n + ".html?ts=" + Date.now();
  history.replaceState(null,"","#page-"+n);
}

function printOne(){
  const frame=document.getElementById("pv");
  if(frame && frame.contentWindow){
    frame.contentWindow.focus();
    frame.contentWindow.print();
  } else {
    window.print();
  }
}

async function loadBook(){
  const r = await fetch("./book.json?ts="+Date.now());
  book = await r.json();
  document.getElementById("t").textContent = book.title || "משוואות ריבועיות";
  document.getElementById("st").textContent = book.subtitle || "פתור את המשוואות הבאות:";
  const nav=document.getElementById("nav");
  nav.innerHTML="";
  // page buttons
  (book.pages||[]).forEach(p=>{
    const b=document.createElement("button");
    b.className="btn";
    b.textContent = p.label || ("דף "+p.n);
    b.onclick=()=>setFrame(p.n);
    nav.appendChild(b);
  });
  // actions
  const pr=document.createElement("button");
  pr.className="btn primary";
  pr.textContent="הדפס דף זה";
  pr.onclick=printOne;
  nav.appendChild(pr);

  const rf=document.createElement("button");
  rf.className="btn";
  rf.textContent="רענון";
  rf.onclick=()=>location.reload();
  nav.appendChild(rf);

  const m = location.hash.match(/page-(\d+)/);
  if(m) setFrame(parseInt(m[1],10));
}
loadBook().catch(()=>{ /* keep default */ });
</script>
</body>
</html>
